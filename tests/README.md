# テスト仕様ドキュメント

このドキュメントは、`stockv2` プロジェクトのテスト戦略と、利用可能なテストの実行方法について概説します。

## 1. テストの実行方法

テストは、一貫した環境を保証するためにDockerコンテナ内で実行されます。`Makefile` に、テストを簡単に実行するためのコマンドが用意されています。

### 全てのテストを実行

ユニットテストとインテグレーションテストの両方を含む、全てのテストスイートを実行します。

```bash
make test
```

### ユニットテストのみを実行

高速で、データベースなどの外部システムに依存しないユニットテストのみを実行します。

```bash
make test-unit
```

### インテグレーションテストのみを実行

データベースとの連携など、アプリケーションのコンポーネント間の相互作用をテストするインテグレーションテストを実行します。

```bash
make test-integration
```

## 2. テスト仕様

テストスイートは、主に「ユニットテスト」と「インテグレーションテスト」の2つのカテゴリに分かれています。

### 2.1. ユニットテスト

- **場所**: `tests/test_unit/`
- **目的**: データベースのような外部システムに依存せず、個々の関数（ユニット）が独立して正しく動作することを検証します。

#### 対象となる関数:

- **`stock_utils.create_features`**:
    - `test_create_features_calculates_sma`: 単純移動平均（SMA）が正しく計算されることを確認します。
    - `test_create_features_calculates_rsi`: 相対力指数（RSI）が、常に価格が上昇する単純な入力に対して正しく `100` と計算されることを確認します。

- **`train_model.create_classification_target`**:
    - `test_create_classification_target_up`: 価格の上昇（up）トレンドに対する目的変数が、将来の価格変動に基づいて正しく `1` または `0` として生成されることを検証します。
    - `test_create_classification_target_down`: 価格の下落（down）トレンドに対する目的変数が正しく生成されることを検証します。

### 2.2. インテグレーションテスト

- **場所**: `tests/test_integration/`
- **目的**: アプリケーションの異なる部分が期待通りに連携して動作すること、特にデータベースとの相互作用を検証します。

#### 対象となる機能:

- **`manage_tickers.py` スクリプト**:
    - `test_manage_tickers_integration`: 銘柄管理スクリプトの完全なライフサイクルテストを実施します。このテストは以下の内容を検証します。
        1. 新しいテスト用銘柄がデータベースに正常に**追加**されること。
        2. 追加された銘柄が、登録済み銘柄の**一覧に表示**されること。
        3. 銘柄が正常に**削除**されること。
        4. 削除された銘柄が、再度一覧に**表示されない**こと。

このテストは、テスト環境内でのデータベース接続と、銘柄に対する基本的なCRUD（作成、読み取り、更新、削除）操作が正しく機能することを保証します。
